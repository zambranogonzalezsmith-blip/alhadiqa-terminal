<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>AL-HADIQA INVEST | TOTAL CONTROL V.10</title>
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <style>
        :root {
            --bg: #050505; --panel: #0e1015; --gold: #d4af37; --cyan: #00f2ea;
            --win: #00e676; --loss: #ff1744; --border: rgba(212, 175, 55, 0.3);
        }
        * { box-sizing: border-box; font-family: 'JetBrains Mono', monospace; margin: 0; padding: 0; }
        body { background: var(--bg); color: #cfd8dc; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* --- LAYOUT VERTICAL --- */
        .top-dashboard { height: 45%; background: var(--panel); border-bottom: 2px solid var(--border); display: flex; padding: 15px; gap: 15px; overflow-x: auto; }
        .bottom-chart { height: 55%; position: relative; background: #000; }

        /* SECCIONES DEL DASHBOARD */
        .dash-col { flex: 1; min-width: 300px; display: flex; flex-direction: column; gap: 10px; border-right: 1px solid #222; padding-right: 15px; }
        .dash-col:last-child { border-right: none; }

        /* BRANDING */
        .brand { color: var(--gold); font-weight: 900; font-size: 14px; border-bottom: 1px solid var(--border); padding-bottom: 5px; margin-bottom: 5px; }

        /* INDICADOR LUX CENTRALIZADO */
        .lux-overlay {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            z-index: 50; text-align: center; display: none; pointer-events: none;
        }
        .arrow-icon { font-size: 80px; filter: drop-shadow(0 0 20px currentColor); animation: pulse 1.5s infinite; }

        /* ELEMENTOS DINÁMICOS */
        .live-price { font-size: 24px; color: #fff; text-align: center; padding: 10px; border: 1px solid var(--cyan); border-radius: 4px; background: rgba(0,242,234,0.05); }
        .btn-action { width: 100%; padding: 12px; border: none; font-weight: bold; cursor: pointer; text-transform: uppercase; font-size: 11px; margin-bottom: 5px; }
        
        /* GESTIÓN DE HERRAMIENTAS (INDICADORES) */
        .tool-manager { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; }
        .tool-toggle { background: #1a1d23; border: 1px solid #333; color: #666; padding: 6px; font-size: 9px; cursor: pointer; text-align: center; border-radius: 3px; }
        .tool-active { border-color: var(--cyan); color: var(--cyan); background: rgba(0, 242, 234, 0.05); }

        .data-card { background: rgba(255,255,255,0.02); padding: 10px; border-radius: 4px; font-size: 11px; }
        .row { display: flex; justify-content: space-between; margin-bottom: 4px; }
        .val { font-weight: bold; color: #fff; }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

    <header class="top-dashboard">
        
        <div class="dash-col">
            <div class="brand">AL-HADIQA | CONTROL CENTER</div>
            <div class="panel-title" style="font-size: 9px; color: #666;">BTC/USDT REAL-TIME FEED</div>
            <div id="btc-price" class="live-price">Cargando...</div>
            <div class="data-card" style="margin-top:5px;">
                <div class="row"><span>ESTADO:</span> <span class="val" style="color:var(--win)">CONECTADO</span></div>
                <div class="row"><span>LATENCIA:</span> <span class="val">24ms</span></div>
            </div>
        </div>

        <div class="dash-col" style="min-width: 350px;">
            <div class="brand">TECHNICAL ANALYSIS</div>
            <div style="height: 140px; overflow: hidden;">
                <div class="tradingview-widget-container">
                    <div class="tradingview-widget-container__widget"></div>
                    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-technical-analysis.js" async>
                    {
                        "interval": "15m", "width": "100%", "isTransparent": true, "height": "100%",
                        "symbol": "BINANCE:BTCUSDT", "showIntervalTabs": false, "displayMode": "single",
                        "locale": "es", "colorTheme": "dark"
                    }
                    </script>
                </div>
            </div>
        </div>

        <div class="dash-col">
            <div class="brand">TOOL MANAGER</div>
            <div class="tool-manager" id="tool-box">
                <div class="tool-toggle tool-active" onclick="toggleTool(this, 'lux')">FLECHAS LUX</div>
                <div class="tool-toggle tool-active" onclick="toggleTool(this, 'calc')">CALCULADORA</div>
                <div class="tool-toggle tool-active" onclick="toggleTool(this, 'checklist')">CHECKLIST SMC</div>
                <div class="tool-toggle" onclick="toggleTool(this, 'fvg')">FVG SCANNER</div>
                <div class="tool-toggle" onclick="toggleTool(this, 'ob')">ORDER BLOCKS</div>
                <div class="tool-toggle" onclick="toggleTool(this, 'news')">HIGH IMPACT NEWS</div>
            </div>
        </div>

        <div class="dash-col">
            <div class="brand">EXECUTION GATEWAY</div>
            <div style="display: flex; gap: 5px;">
                <button class="btn-action" style="background:var(--win)" onclick="generatePlan('LONG')">BUY LONG</button>
                <button class="btn-action" style="background:var(--loss)" onclick="generatePlan('SHORT')">SELL SHORT</button>
            </div>
            <div id="plan-output" class="data-card" style="display:none; border-left: 3px solid var(--gold);">
                <div class="row"><span>ENTRY:</span> <span id="res-entry" class="val">---</span></div>
                <div class="row"><span>STOP:</span> <span id="res-sl" class="val" style="color:var(--loss)">---</span></div>
                <div class="row"><span>TP (1:3):</span> <span id="res-tp" class="val" style="color:var(--win)">---</span></div>
                <div class="row" style="margin-top:5px; border-top:1px solid #333;"><span>LOTS:</span> <span id="res-lots" class="val" style="color:var(--cyan)">0.00 BTC</span></div>
            </div>
        </div>

    </header>

    <main class="bottom-chart">
        <div id="lux-visual" class="lux-overlay">
            <div id="lux-arrow" class="arrow-icon">▲</div>
            <div id="lux-msg" style="color:#fff; font-weight:bold; background:rgba(0,0,0,0.8); padding:5px 10px; border:1px solid #fff;">ORDEN ACTIVA</div>
        </div>

        <div id="tv-chart" style="width:100%; height:100%"></div>
    </main>

    <script>
        let currentPrice = 0;
        let toolsActive = { lux: true, calc: true, checklist: true };

        function initChart() {
            new TradingView.widget({
                "autosize": true, "symbol": "BINANCE:BTCUSDT", "interval": "15",
                "timezone": "Etc/UTC", "theme": "dark", "container_id": "tv-chart",
                "style": "1", "allow_symbol_change": true,
                "studies": ["MAExp@tv-basicstudies", "RSI@tv-basicstudies"]
            });
        }

        async function fetchPrice() {
            try {
                const response = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT');
                const data = await response.json();
                currentPrice = parseFloat(data.price);
                document.getElementById('btc-price').innerText = `$${currentPrice.toFixed(2)}`;
            } catch (e) { document.getElementById('btc-price').innerText = "OFFLINE"; }
        }

        function toggleTool(el, toolName) {
            el.classList.toggle('tool-active');
            toolsActive[toolName] = el.classList.contains('tool-active');
            
            // Acción específica si se apaga Flecha Lux
            if(toolName === 'lux' && !toolsActive.lux) {
                document.getElementById('lux-visual').style.display = 'none';
            }
        }

        function generatePlan(type) {
            if(currentPrice === 0) return;
            
            const slDist = currentPrice * 0.005; 
            const tpDist = slDist * 3;
            let sl = (type === 'LONG') ? currentPrice - slDist : currentPrice + slDist;
            let tp = (type === 'LONG') ? currentPrice + tpDist : currentPrice - tpDist;

            // Mostrar Flecha Lux solo si la herramienta está activa
            if(toolsActive.lux) {
                const lux = document.getElementById('lux-visual');
                lux.style.display = 'block';
                document.getElementById('lux-arrow').innerText = (type === 'LONG') ? "▲" : "▼";
                document.getElementById('lux-arrow').style.color = (type === 'LONG') ? "var(--win)" : "var(--loss)";
                setTimeout(() => lux.style.display = 'none', 4000);
            }

            // Mostrar Resultados
            document.getElementById('plan-output').style.display = 'block';
            document.getElementById('res-entry').innerText = currentPrice.toFixed(2);
            document.getElementById('res-sl').innerText = sl.toFixed(2);
            document.getElementById('res-tp').innerText = tp.toFixed(2);
            
            // Calculadora Lotes (Balance base 1000)
            const lots = (1000 * 0.01) / slDist;
            document.getElementById('res-lots').innerText = lots.toFixed(5) + " BTC";
        }

        window.onload = () => {
            initChart();
            fetchPrice();
            setInterval(fetchPrice, 1000);
        };
    </script>
</body>
</html>
