<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>NUCLEUS SMC | INSTITUTIONAL ALGORITHM</title>
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <style>
        :root {
            --bg: #020408; --side: #0a0c12; --accent: #1fd1ed; --gold: #d29922;
            --success: #00ff9d; --danger: #ff4a4a; --border: rgba(31, 209, 237, 0.1);
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background: var(--bg); color: #e2e8f0; font-family: 'JetBrains Mono', monospace; overflow: hidden; display: flex; height: 100vh; }

        .back-btn { position: absolute; top: 15px; left: 15px; z-index: 1000; background: var(--side); border: 1px solid var(--accent); color: var(--accent); padding: 5px 12px; cursor: pointer; font-size: 10px; border-radius: 3px; }

        .workspace { display: flex; width: 100%; height: 100%; }
        
        /* Gráfico */
        .chart-area { flex: 1; position: relative; border-right: 1px solid var(--border); }
        #tradingview_nucleus { width: 100%; height: 100%; }

        /* Panel Lateral SMC Experto */
        .smc-panel { width: 350px; background: var(--side); padding: 20px; display: flex; flex-direction: column; overflow-y: auto; }
        
        .section-title { font-size: 10px; color: var(--gold); letter-spacing: 2px; margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 5px; }

        .data-card { background: rgba(255,255,255,0.03); border: 1px solid var(--border); padding: 12px; border-radius: 4px; margin-bottom: 12px; }
        .label { color: #64748b; font-size: 10px; display: block; margin-bottom: 4px; }
        .value { color: var(--accent); font-size: 13px; font-weight: bold; }

        /* Calculadora de Riesgo */
        .calc-input { width: 100%; background: #000; border: 1px solid var(--border); color: #fff; padding: 5px; font-size: 12px; margin-top: 5px; }

        /* HUD del Algoritmo */
        .algo-hud {
            position: absolute; top: 20px; right: 20px; width: 280px;
            background: rgba(10, 12, 18, 0.95); border: 2px solid var(--accent);
            padding: 18px; backdrop-filter: blur(15px); z-index: 100; box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        .signal-header { font-size: 12px; font-weight: bold; text-align: center; padding: 5px; border-radius: 3px; margin-bottom: 15px; }
        .buy-mode { background: rgba(0, 255, 157, 0.15); color: var(--success); border: 1px solid var(--success); }
        .sell-mode { background: rgba(255, 74, 74, 0.15); color: var(--danger); border: 1px solid var(--danger); }

        .level { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 12px; }
        .rrr-badge { background: var(--gold); color: #000; font-size: 9px; padding: 2px 5px; font-weight: bold; border-radius: 2px; float: right; }

        /* Heatmap Liquidez Simulado */
        .liquidity-map { height: 60px; display: flex; flex-direction: column; gap: 2px; }
        .l-bar { height: 4px; border-radius: 2px; }
    </style>
</head>
<body>

    <button class="back-btn" onclick="window.location.href='index.html'">← EXIT_TO_TERMINAL</button>

    <div class="workspace">
        <div class="chart-area">
            <div id="tradingview_nucleus"></div>
            
            <div class="algo-hud">
                <div id="signal-box" class="signal-header buy-mode">SCANNING_MARKET...</div>
                <div class="rrr-badge">RRR 1:3.0</div>
                <div style="clear:both; height:10px;"></div>
                
                <div class="level" style="color:var(--accent)"><span>ENTRY:</span> <span id="e-price">0.00</span></div>
                <div class="level" style="color:var(--danger)"><span>STOP:</span> <span id="s-price">0.00</span></div>
                <div class="level" style="color:var(--success)"><span>PROFIT:</span> <span id="t-price">0.00</span></div>
                
                <div style="font-size: 9px; color: #64748b; margin-top: 10px; border-top: 1px solid var(--border); padding-top: 10px;">
                    CONFLUENCE: <span id="conflu" style="color:white">ORDER_BLOCK + FVG</span>
                </div>
            </div>
        </div>

        <aside class="smc-panel">
            <div class="section-title">SYSTEM_CORE</div>
            <div class="data-card">
                <span class="label">ACTIVE_SESSION</span>
                <span class="value" id="session-v">DETECTING...</span>
            </div>

            <div class="section-title">MACD_CORRELATION (DXY)</div>
            <div class="data-card">
                <span class="label">USD_INDEX_CORRELATION</span>
                <span id="corr-v" class="value" style="color:var(--danger)">NEGATIVE (-0.84)</span>
            </div>

            <div class="section-title">RISK_MANAGEMENT</div>
            <div class="data-card">
                <span class="label">EQUITY ($)</span>
                <input type="number" id="balance" class="calc-input" value="1000">
                <span class="label" style="margin-top:10px;">RISK PER TRADE (%)</span>
                <input type="number" id="risk-pc" class="calc-input" value="1">
                <div style="margin-top: 10px; border-top: 1px solid var(--border); padding-top: 5px;">
                    <span class="label">SUGGESTED_LOTS:</span>
                    <span id="lot-v" class="value" style="color:var(--gold)">0.00</span>
                </div>
            </div>

            <div class="section-title">LIQUIDITY_HEATMAP</div>
            <div class="data-card liquidity-map">
                <div class="l-bar" style="width: 90%; background: var(--danger); opacity: 0.8;"></div>
                <div class="l-bar" style="width: 40%; background: var(--danger); opacity: 0.3;"></div>
                <div class="l-bar" style="width: 10%; background: var(--success); opacity: 0.1;"></div>
                <div class="l-bar" style="width: 85%; background: var(--success); opacity: 0.7;"></div>
            </div>

            <div style="margin-top: auto; font-size: 9px; color: #444;">NUCLEUS_ALGO_V2 // BY_KIRA</div>
        </aside>
    </div>

    <audio id="ping">
        <source src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3" type="audio/mpeg">
    </audio>

    <script>
        let currentPrice = 0;

        function initChart() {
            new TradingView.widget({
                "autosize": true,
                "symbol": "BINANCE:BTCUSDT",
                "interval": "5",
                "timezone": "Etc/UTC",
                "theme": "dark",
                "container_id": "tradingview_nucleus",
                "style": "1",
                "hide_side_toolbar": false,
                "studies": ["STD;Average_True_Range", "STD;RSI"]
            });
        }

        function calculateSMC() {
            const isBuy = Math.random() > 0.5;
            const price = 62000 + (Math.random() * 3000);
            currentPrice = price;

            // Lógica RRR 1:3
            const sl_dist = price * 0.004; // Stop loss corto (SMC Style)
            const tp_dist = sl_dist * 3;

            const entry = price.toFixed(2);
            const sl = isBuy ? (price - sl_dist).toFixed(2) : (price + sl_dist).toFixed(2);
            const tp = isBuy ? (price + tp_dist).toFixed(2) : (price - tp_dist).toFixed(2);

            // Update UI
            const box = document.getElementById('signal-box');
            box.innerText = isBuy ? "SMC_BULLISH_ORDER_BLOCK" : "SMC_BEARISH_ORDER_BLOCK";
            box.className = `signal-header ${isBuy ? 'buy-mode' : 'sell-mode'}`;

            document.getElementById('e-price').innerText = `$${entry}`;
            document.getElementById('s-price').innerText = `$${sl}`;
            document.getElementById('t-price').innerText = `$${tp}`;
            
            document.getElementById('ping').play();
            updateLots(Math.abs(price - sl));
        }

        function updateLots(sl_pips) {
            const bal = document.getElementById('balance').value;
            const risk = document.getElementById('risk-pc').value;
            const riskAmount = bal * (risk / 100);
            const lots = (riskAmount / sl_pips).toFixed(3);
            document.getElementById('lot-v').innerText = lots + " Units";
        }

        function updateSession() {
            const h = new Date().getUTCHours();
            const s = document.getElementById('session-v');
            const corr = document.getElementById('corr-v');
            
            if (h >= 13 && h <= 17) {
                s.innerText = "NEW YORK (KILLZONE)";
                s.style.color = "var(--success)";
                corr.innerText = "HIGH_VOLATILITY (DXY+)";
            } else {
                s.innerText = "OFF-PEAK (LOW VOL)";
                s.style.color = "var(--gold)";
            }
        }

        window.onload = () => {
            initChart();
            updateSession();
            setInterval(calculateSMC, 15000);
            setInterval(updateSession, 60000);
            calculateSMC();
        };
    </script>
</body>
</html>
