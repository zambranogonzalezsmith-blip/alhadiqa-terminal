<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ALHADIQA | Orbital Terminal</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
</head>
<body class="system-boot menu-collapsed">

    <header class="orbital-hud">
        <div class="hud-left">
            <button class="terminal-trigger" onclick="toggleMenu()">
                <span class="glitch" data-text="ALHADIQA">ALHADIQA</span>
            </button>
            <div class="connection-status">
                <span class="ping-dot"></span>
                <small id="latency">00ms</small>
            </div>
        </div>
        <div class="hud-center">
            <div id="signal-text" class="scrolling-ticker">INITIALIZING_SMC_SCANNER...</div>
        </div>
        <div class="hud-right">
            <div class="clock-wrap">
                <span id="digital-clock">00:00:00</span>
                <small>UTC</small>
            </div>
        </div>
    </header>

    <div class="main-universe">
        <aside class="floating-sidebar" id="sidebar">
            <div class="nav-cluster">
                <a href="#" class="nav-link active"><span>ðŸ“ˆ</span> Terminal</a>
                <a href="#" onclick="abrirPasarela()" class="nav-link"><span>ðŸ’³</span> Kira Pay</a>
                <a href="https://www.investing.com/economic-calendar/" target="_blank" class="nav-link"><span>ðŸ“…</span> Calendar</a>
            </div>
            <div class="nav-cluster bottom">
                <button class="action-btn" onclick="ejecutarDiagnostico()">DIAGNOSTIC</button>
                <button class="collapse-btn" onclick="toggleMenu()">â‰ª</button>
            </div>
        </aside>

        <main class="chart-viewport">
            <div id="main-chart"></div>
            
            <div class="ui-overlay">
                <div class="floating-card engine-card">
                    <div class="card-glass">
                        <div class="engine-info">
                            <span class="tag">KIRA_ALGO_v4.0</span>
                            <div id="kira-signal-box" class="signal-indicator">
                                <span id="kira-action">SCANNING</span>
                            </div>
                        </div>
                        <div class="metric-grid">
                            <div class="m-item">
                                <label>LOT</label>
                                <strong id="suggested-lot" class="cyan-text">0.01</strong>
                            </div>
                            <div class="m-item">
                                <label>SPREAD</label>
                                <span id="kira-spread">0.0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="floating-card controls-card">
                    <div class="card-glass">
                        <select id="asset-selector" onchange="cargarActivo()" class="cyber-select">
                            <option value="BTC">BTC/USDT</option>
                            <option value="ETH">ETH/USDT</option>
                            <option value="EURUSD">EUR/USD</option>
                        </select>
                        <div class="tf-pill-box">
                            <button class="tf-pill" onclick="cambiarTF('1m')">1M</button>
                            <button class="tf-pill active" onclick="cambiarTF('15m')">15M</button>
                            <button class="tf-pill" onclick="cambiarTF('1h')">1H</button>
                        </div>
                    </div>
                </div>

                <div class="floating-card telemetry-card">
                    <div class="card-glass">
                        <div class="price-header">
                            <h2 id="current-price">$0.00</h2>
                            <small id="asset-name">BITCOIN</small>
                        </div>
                        <div class="rsi-container">
                            <div class="rsi-meta">RSI: <span id="rsi-value">--</span></div>
                            <div class="rsi-track"><div id="rsi-fill"></div></div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="crypto-modal" class="modal-blur">
        <div class="cyber-modal">
            <header>
                <h3>SECURE_GATEWAY</h3>
                <button onclick="cerrarPasarela()">Ã—</button>
            </header>
            <div class="qr-zone">
                <img id="qr-deposit" src="">
            </div>
            <div class="hash-box" onclick="copyWallet()">
                <span id="wallet-addr">0x738...</span>
            </div>
            <button class="meta-btn" onclick="conectarMetaMask()">EXECUTE WEB3 LINK</button>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        function toggleMenu() {
            document.body.classList.toggle('menu-collapsed');
            // Fix de GrÃ¡fica: Esperar a la transiciÃ³n CSS antes de redimensionar
            setTimeout(() => { 
                if(window.chart) {
                    const container = document.getElementById('main-chart');
                    window.chart.applyOptions({ width: container.clientWidth, height: container.clientHeight });
                }
            }, 300);
        }

        setInterval(() => {
            const now = new Date();
            document.getElementById('digital-clock').innerText = now.toLocaleTimeString('en-GB', {timeZone:'UTC'});
        }, 1000);

        function abrirPasarela() { document.getElementById('crypto-modal').style.display = 'flex'; if(window.KIRA_PAY) KIRA_PAY.abrir(); }
        function cerrarPasarela() { document.getElementById('crypto-modal').style.display = 'none'; }
        function copyWallet() {
            navigator.clipboard.writeText(document.getElementById('wallet-addr').innerText);
            const box = document.querySelector('.hash-box');
            box.style.borderColor = 'var(--success)';
            setTimeout(() => box.style.borderColor = '', 1000);
        }
    </script>
</body>
</html>
